<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Jean V. Adams" />

<meta name="date" content="2015-12-30" />

<title>Introduction to EchoNet2Fish</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Introduction to EchoNet2Fish</h1>
<h4 class="author"><em>Jean V. Adams</em></h4>
<h4 class="date"><em>2015-12-30</em></h4>
</div>


<p>The R package <strong>EchoNet2Fish</strong> estimates fish abundance from acoustic echoes and midwater trawl catch. At its core are two functions that explore the data, <code>exploreACMT</code>, and generate the estimates, <code>estimateACMT</code>. The code is tailored to the format and procedures used by the Great Lakes Acoustic Users Group (Parker-Stetter et al. 2009).</p>
<div id="install" class="section level2">
<h2>Install</h2>
<p>Install the <strong>EchoNet2Fish</strong> package following the instructions at <a href="https://github.com/JVAdams/EchoNet2Fish/blob/master/README.md">Readme</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">&quot;JVAdams/EchoNet2Fish&quot;</span>)</code></pre>
<p>Then load the <strong>EchoNet2Fish</strong> package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(EchoNet2Fish)</code></pre>
</div>
<div id="prepare-the-data" class="section level2">
<h2>Prepare the data</h2>
<p>Before any estimates are made, the acoustic and midwater trawl data must be prepared in the following way.</p>
<div id="file-organization" class="section level4">
<h4>File organization</h4>
<p>For each set of data for which you would like to generate estimates (e.g., for one year of data from one lake), you should have a single sub directory (<code>subdir</code>) containing all of the relevant files. For example, you might have a subdirectories called <em>H13</em>, <em>H14</em>, and <em>M14</em>, containing all of the data for Lake Huron in 2013 and 2014 and Lake Michigan in 2014. Within this subdirectory, you will have two more subdirectories for the acoustic data (one for all the Sv files and one for all the TS files), and you will have all of your midwater trawl files (operations, catches, lengths, and age-length keys). Above this subdirectory should be an overarching directory (<code>refdir</code>) that contains a reference csv file (<code>refcsv</code>).</p>
<ul>
<li><code>refdir</code>
<ul>
<li><code>refcsv</code>.csv</li>
<li><code>subdir</code> (e.g., H13)
<ul>
<li><code>svsubdir</code>
<ul>
<li>x.csv</li>
<li>y.csv</li>
<li>z.csv</li>
</ul></li>
<li><code>tssubdir</code>
<ul>
<li>x.csv</li>
<li>y.csv</li>
<li>z.csv</li>
</ul></li>
<li><code>optropf</code>.csv</li>
<li><code>trcatchf</code>.csv</li>
<li><code>trlff</code>.csv</li>
<li><code>keyfile1</code>.csv</li>
<li><code>keyfile2</code>.csv</li>
</ul></li>
<li><code>subdir</code> (e.g., H14)
<ul>
<li><code>svsubdir</code>
<ul>
<li>x.csv</li>
<li>y.csv</li>
<li>z.csv</li>
</ul></li>
<li><code>tssubdir</code>
<ul>
<li>x.csv</li>
<li>y.csv</li>
<li>z.csv</li>
</ul></li>
<li><code>optropf</code>.csv</li>
<li><code>trcatchf</code>.csv</li>
<li><code>trlff</code>.csv</li>
<li><code>keyfile1</code>.csv</li>
<li><code>keyfile2</code>.csv</li>
</ul></li>
<li><code>subdir</code> …</li>
</ul></li>
</ul>
</div>
<div id="reference-file" class="section level4">
<h4>Reference file</h4>
<p>The reference csv file contains information, primarily the directory and file names for the acoustic and midwater trawl data, for all of the subdirectories (one row for each subdirectory). The file must contain these 10 columns:</p>
<ul>
<li><code>subdir</code> = a subdirectory of <code>refdir</code> containing all the other subdirectories and files,<br /></li>
<li><code>svsubdir</code> = the Sv subdirectory,<br /></li>
<li><code>tssubdir</code> = the TS subdirectory,<br /></li>
<li><code>optropf</code> = the midwater trawl operations file,<br /></li>
<li><code>trcatchf</code> = the midwater trawl catch file,<br /></li>
<li><code>trlff</code> = the midwater trawl lengths file,<br /></li>
<li><code>keysp1</code> = the species code for keyfile1,<br /></li>
<li><code>keyfile1</code> = the age-length csv file for specieskeysp1,<br /></li>
<li><code>keysp2</code> = the species code for keyfile2, and<br /></li>
<li><code>keyfile2</code> = the age-length csv file for specieskeysp2.</li>
</ul>
<p>There should also be one or more additional columns for <code>keyvars</code>, the key variable(s) used to define each unique run of the exploration and estimation process. In the example below, <code>LAKE</code> and <code>YEAR</code> are used as the key variables.</p>
<table>
<thead>
<tr class="header">
<th align="right">LAKE</th>
<th align="right">YEAR</th>
<th align="left">subdir</th>
<th align="left">svsubdir</th>
<th align="left">tssubdir</th>
<th align="left">optropf</th>
<th align="left">trcatchf</th>
<th align="left">trlff</th>
<th align="right">keysp1</th>
<th align="left">keyfile1</th>
<th align="left">keysp2</th>
<th align="left">keyfile2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="right">2013</td>
<td align="left">H13</td>
<td align="left">SV</td>
<td align="left">TS</td>
<td align="left">H.mtr.op13</td>
<td align="left">H.catch13</td>
<td align="left">Htr_lf13</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">2014</td>
<td align="left">H14</td>
<td align="left">SV</td>
<td align="left">TS</td>
<td align="left">H.mtr.op14</td>
<td align="left">H.catch14</td>
<td align="left">H.tr_lf14</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">2014</td>
<td align="left">M14</td>
<td align="left">SV</td>
<td align="left">TS</td>
<td align="left">MtrawlOp</td>
<td align="left">M.catch</td>
<td align="left">M.tr_lf</td>
<td align="right">106</td>
<td align="left">aleagelenkey</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="acoustic-files" class="section level4">
<h4>Acoustic files</h4>
<p>Except where noted, the order of the rows and columns in any of the acoustic or midwater trawl files is not important. Additional columns, i.e., other than those that are required, may be included in the files, but are not necessary.</p>
<p>In both the <strong>SV and TS</strong> csv files, the first column is automatically assigned the name <em>Region_ID</em>. This name write-over is needed to handle occasional problems with byte order marks at the beginning of the csv files. The variable <em>Region_ID</em> is not actually used in the exploration or estimation procedures.</p>
<p>The following 3 columns must be included in both the <strong>SV and TS</strong> csv files:</p>
<ul>
<li>Region_name = transect name, composed of region and transect ID number</li>
<li>Interval = interval ID numbers, identifying acoustic transect segments</li>
<li>Layer = layer ID numbers, identifying 10-m acoustic layers in the water column, numbered from the surface to the bottom</li>
</ul>
<p>These columns serve to uniquely identify each row in the files, and are used to combine the information from both types of files.</p>
<p>The following 12 columns must be included in the <strong>SV</strong> csv files:</p>
<ul>
<li>Date_M = date, YYYYMMDD</li>
<li>Sv_mean = mean volume backscattering strength in dB</li>
<li>Depth_mean = range to target in m</li>
<li>Layer_depth_min = minimum of corresponding depth layer in m</li>
<li>Layer_depth_max = maximum of corresponding depth layer in m</li>
<li>Lat_M = latitude in decimal degrees</li>
<li>Lon_M = longitude in decimal degrees</li>
<li>PRC_ABC = area backscattering coefficient (unitless)</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">Region_name</th>
<th align="right">Interval</th>
<th align="right">Layer</th>
<th align="left">Date_M</th>
<th align="right">Sv_mean</th>
<th align="right">Depth_mean</th>
<th align="right">Layer_depth_min</th>
<th align="right">Layer_depth_max</th>
<th align="right">Lat_M</th>
<th align="right">Lon_M</th>
<th align="left">PRC_ABC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">nn5</td>
<td align="right">1</td>
<td align="right">8</td>
<td align="left">20140806</td>
<td align="right">-83.5</td>
<td align="right">74.9</td>
<td align="right">70</td>
<td align="right">80</td>
<td align="right">45.36</td>
<td align="right">-85.44</td>
<td align="left">3.78e-08</td>
</tr>
<tr class="even">
<td align="left">nn2</td>
<td align="right">3</td>
<td align="right">9</td>
<td align="left">20140812</td>
<td align="right">-73.9</td>
<td align="right">85.0</td>
<td align="right">80</td>
<td align="right">90</td>
<td align="right">44.18</td>
<td align="right">-86.48</td>
<td align="left">4.11e-07</td>
</tr>
<tr class="odd">
<td align="left">no2</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="left">20140807</td>
<td align="right">-90.9</td>
<td align="right">25.0</td>
<td align="right">20</td>
<td align="right">30</td>
<td align="right">44.08</td>
<td align="right">-86.84</td>
<td align="left">8.21e-09</td>
</tr>
<tr class="even">
<td align="left">sn2</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">20140820</td>
<td align="right">-79.7</td>
<td align="right">6.5</td>
<td align="right">0</td>
<td align="right">10</td>
<td align="right">42.11</td>
<td align="right">-86.70</td>
<td align="left">7.54e-08</td>
</tr>
<tr class="odd">
<td align="left">nn4</td>
<td align="right">6</td>
<td align="right">4</td>
<td align="left">20140811</td>
<td align="right">-107.1</td>
<td align="right">35.0</td>
<td align="right">30</td>
<td align="right">40</td>
<td align="right">44.96</td>
<td align="right">-86.01</td>
<td align="left">1.96e-10</td>
</tr>
</tbody>
</table>
<p>Several columns must be included in the <strong>TS</strong> csv files indicating the number of targets in each target strength bin. Each target count columns is named according to the integer target strength, with an <em>X.</em> prefix, e.g.:</p>
<ul>
<li>X.16</li>
<li>X.17</li>
<li>…</li>
<li>X.75</li>
<li>X.76</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">Region_name</th>
<th align="right">Interval</th>
<th align="right">Layer</th>
<th align="right">X.36</th>
<th align="right">X.37</th>
<th align="right">X.38</th>
<th align="right">X.64</th>
<th align="right">X.65</th>
<th align="right">X.66</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">no5</td>
<td align="right">3</td>
<td align="right">16</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">100</td>
<td align="right">109</td>
<td align="right">95</td>
</tr>
<tr class="even">
<td align="left">sn3</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">nn1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">no6</td>
<td align="right">9</td>
<td align="right">14</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">8</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">so2</td>
<td align="right">8</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="midwater-trawl-files" class="section level4">
<h4>Midwater trawl files</h4>
<p>The following 1 column must be included in the midwater trawl <strong>operation</strong>, <strong>catch</strong>, and <strong>length</strong> csv files:</p>
<ul>
<li>Op.Id = operation ID number</li>
</ul>
<p>This column serves to uniquely identify each trawl haul in the files.</p>
<p>The following 9 columns must be included in the midwater trawl <strong>operation</strong> csv files:</p>
<ul>
<li>Year = year</li>
<li>Lake = lake ID code</li>
<li>Beg.Depth = bottom depth at beginning of trawl haul in m</li>
<li>End.Depth = bottom depth at end of trawl haul in m</li>
<li>Fishing_Depth = fishing depth of trawl haul in m</li>
<li>Transect = transect name, composed of region and transect ID number (corresponds to Region_name in SV and TS files)</li>
<li>Latitude = latitude in decimal degrees</li>
<li>Longitude = longitude in decimal degrees</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="right">Op.Id</th>
<th align="right">Year</th>
<th align="right">Lake</th>
<th align="right">Beg.Depth</th>
<th align="right">End.Depth</th>
<th align="right">Fishing_Depth</th>
<th align="left">Transect</th>
<th align="right">Latitude</th>
<th align="right">Longitude</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">89429</td>
<td align="right">2014</td>
<td align="right">2</td>
<td align="right">32.9</td>
<td align="right">38.4</td>
<td align="right">3.4</td>
<td align="left">nn8</td>
<td align="right">45.46</td>
<td align="right">-86.66</td>
</tr>
<tr class="even">
<td align="right">88634</td>
<td align="right">2014</td>
<td align="right">2</td>
<td align="right">112.2</td>
<td align="right">103.6</td>
<td align="right">60.0</td>
<td align="left">no1</td>
<td align="right">43.74</td>
<td align="right">-87.29</td>
</tr>
<tr class="odd">
<td align="right">89422</td>
<td align="right">2014</td>
<td align="right">2</td>
<td align="right">52.0</td>
<td align="right">47.0</td>
<td align="right">11.0</td>
<td align="left">nn5</td>
<td align="right">45.36</td>
<td align="right">-85.39</td>
</tr>
<tr class="even">
<td align="right">89427</td>
<td align="right">2014</td>
<td align="right">2</td>
<td align="right">160.0</td>
<td align="right">171.2</td>
<td align="right">3.9</td>
<td align="left">no6</td>
<td align="right">45.36</td>
<td align="right">-86.44</td>
</tr>
<tr class="odd">
<td align="right">89426</td>
<td align="right">2014</td>
<td align="right">2</td>
<td align="right">23.0</td>
<td align="right">27.4</td>
<td align="right">1.8</td>
<td align="left">nn7</td>
<td align="right">45.86</td>
<td align="right">-86.09</td>
</tr>
</tbody>
</table>
<p>The following 3 columns must be included in the midwater trawl <strong>catch</strong> csv files:</p>
<ul>
<li>Species = species code</li>
<li>Weight = aggregate weight in g</li>
<li>N = number of fish weighed</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="right">Op.Id</th>
<th align="right">Species</th>
<th align="right">Weight</th>
<th align="right">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">89422</td>
<td align="right">106</td>
<td align="right">109.8</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">89428</td>
<td align="right">106</td>
<td align="right">6.3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">89414</td>
<td align="right">204</td>
<td align="right">3544.7</td>
<td align="right">65</td>
</tr>
<tr class="even">
<td align="right">89420</td>
<td align="right">106</td>
<td align="right">72.2</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">89430</td>
<td align="right">106</td>
<td align="right">1672.0</td>
<td align="right">82</td>
</tr>
</tbody>
</table>
<p>The following 3 columns must be included in the midwater trawl <strong>length</strong> csv files:</p>
<ul>
<li>Species = species code</li>
<li>Length = length of individual fish in mm</li>
<li>N = number of fish measured</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="right">Op.Id</th>
<th align="right">Species</th>
<th align="right">Length</th>
<th align="right">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">89429</td>
<td align="right">106</td>
<td align="right">157</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">89430</td>
<td align="right">106</td>
<td align="right">167</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">89426</td>
<td align="right">106</td>
<td align="right">118</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">89426</td>
<td align="right">106</td>
<td align="right">139</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">89430</td>
<td align="right">106</td>
<td align="right">160</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
</div>
<div id="age-length-key-files" class="section level4">
<h4>Age-length key files</h4>
<p>No age-length key is required, but you may include age-length keys in separate csv files for up to 2 different species. Each file should be arranged such that rows represent 10-mm length categories and columns represent 1-yr ages. The file must contain one variable called <em>mmgroup</em> giving the midpoint of the length category, e.g., <em>mmgroup</em> 15 represents fish <span class="math">\(\geq\)</span> 10 mm and &lt; 20 mm. For each length category, the proportion of fish in each age is represented by a series of columns which sum to 1 (or 0, if no fish used to derive the key were found that length category). Each proportional column is named according to the integer age, with an <em>Age</em> prefix, e.g.:</p>
<ul>
<li>mmgroup = midpoint of 10-mm length category</li>
<li>Age0 = proportion of all fish in corresponding length category that are age 0</li>
<li>Age1 = proportion … that are age 1</li>
<li>…</li>
<li>Age8 = proportion … that are age 8</li>
<li>Age9 = proportion … that are age 9</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="right">mmgroup</th>
<th align="right">Age0</th>
<th align="right">Age1</th>
<th align="right">Age2</th>
<th align="right">Age3</th>
<th align="right">Age4</th>
<th align="right">Age5</th>
<th align="right">Age6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">95</td>
<td align="right">1</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">105</td>
<td align="right">0</td>
<td align="right">1.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">115</td>
<td align="right">0</td>
<td align="right">0.500</td>
<td align="right">0.500</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">125</td>
<td align="right">0</td>
<td align="right">0.133</td>
<td align="right">0.800</td>
<td align="right">0.000</td>
<td align="right">0.067</td>
<td align="right">0.000</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">135</td>
<td align="right">0</td>
<td align="right">0.145</td>
<td align="right">0.527</td>
<td align="right">0.273</td>
<td align="right">0.036</td>
<td align="right">0.018</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="read-in-the-data" class="section level2">
<h2>Read in the data</h2>
<p>With the data organized as described and the reference file as a guide to the directory and file names, you can now read in the acoustic and midwater trawl data using the <code>readAll</code> function.</p>
<p>In the example below, the overarching directory is <em>C:/Temp</em> (use forward slashes for paths), and the reference file is <em>myref.csv</em>. Only data from the 3rd row of the reference file will be read, specified by <code>keyvals</code> for the <code>keyvars</code>, i.e., <code>LAKE==2</code> and <code>YEAR==2014</code>. The data are saved to an RData file named <em>myACMT</em>, and the subdirectory path is returned.</p>
<pre class="sourceCode r"><code class="sourceCode r">mydir &lt;-<span class="st"> </span><span class="kw">readAll</span>(<span class="dt">refdir=</span><span class="st">&quot;C:/Temp&quot;</span>, <span class="dt">keyvals=</span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2014</span>), 
  <span class="dt">keyvars=</span><span class="kw">c</span>(<span class="st">&quot;LAKE&quot;</span>, <span class="st">&quot;YEAR&quot;</span>), <span class="dt">rdat=</span><span class="st">&quot;myACMT&quot;</span>, <span class="dt">refcsv=</span><span class="st">&quot;myref&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">mydir</code></pre>
<pre><code>## [1] &quot;C:/Temp/M14/&quot;</code></pre>
</div>
<div id="explore-the-data" class="section level2">
<h2>Explore the data</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># exploreACMT(maindir, rdat=&quot;ACMT&quot;, AC=TRUE, MT=TRUE, ageSp=NULL, short=TRUE)</span></code></pre>
<p>To make processing run more smoothly, especially if you have multiple years or lakes that you want to process, you should prepare several pieces of information prior to running any code.</p>
<div id="size-information" class="section level4">
<h4>Size information</h4>
<p>You will need a data frame of species-specific size information for each species group for which you wish to generate abundance estimates. The data frame has five variables: <code>sp</code> species code, <code>spname</code> species name, <code>lcut</code> length cut off (in mm), <code>lwa</code> and <code>lwb</code> parameters of the length-weight relation, <span class="math">\(Wg = lwa*Lmm^{lwb}\)</span>, where <em>Wg</em> is the weight (in g) and <em>Lmm</em> is the total length (in mm). The length cut off is used to divide the data for a given species into two groups for abundance estimation, those with fish lengths <span class="math">\(\leq\)</span> <code>lcut</code> and &gt; <code>lcut</code>) for estimation. If you don’t wish to divide a species into two length groups, set <code>lcut</code> to 0 for that species. This will be used as input to the <code>estimateACMT</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r">myspInfo &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">sp =</span> <span class="kw">c</span>(<span class="dv">106</span>, <span class="dv">109</span>, <span class="dv">129</span>),
  <span class="dt">spname =</span> <span class="kw">c</span>(<span class="st">&quot;alewife&quot;</span>, <span class="st">&quot;rainbow smelt&quot;</span>, <span class="st">&quot;threespine stickleback&quot;</span>),
  <span class="dt">lcut =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">90</span>, <span class="dv">0</span>),
  <span class="dt">lwa =</span> <span class="kw">c</span>(<span class="fl">1.41e-05</span>, <span class="fl">4.85e-06</span>, <span class="fl">3.95e-05</span>),
  <span class="dt">lwb =</span> <span class="kw">c</span>(<span class="fl">2.87</span>, <span class="fl">3.03</span>, <span class="fl">2.59</span>)
)</code></pre>
</div>
<div id="slices" class="section level4">
<h4>Slices</h4>
<p>You will need a definition of the <em>“slices”</em> by which you wish to summarize the abundance estimates. The slices can be defined by combinations of fishing depths (<code>fdp</code>), bottom depths (<code>bdp</code>), longitudes (<code>lon</code>), latitudes (<code>lat</code>), and regions (<code>reg</code>). The slice definition is described by a list of slices; each slice is a list of defining characteristics; and each characteristic is a named vector giving the range of values. This will be used as input to the <code>sliceCat</code> function.</p>
<p>This is easier to explain with some examples. Let’s say you want to define two slices, based on a dividing line at a fishing depth of 20 m. You would write your slice definition as</p>
<pre class="sourceCode r"><code class="sourceCode r">myslice1 &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">epi  =</span> <span class="kw">list</span>(<span class="dt">fdp=</span><span class="kw">c</span>(-<span class="ot">Inf</span>,  <span class="dv">20</span>)),
  <span class="dt">hypo =</span> <span class="kw">list</span>(<span class="dt">fdp=</span><span class="kw">c</span>(  <span class="dv">20</span>, <span class="ot">Inf</span>))
  )</code></pre>
<p>This names the upper slice <em>“epi”</em> and the lower slice <em>“hypo”</em> (you can name the slices whatever you want, but they must be named). And it defines these slices by the corresponding range of fishing depths (<code>fdp</code>), from <span class="math">\(\geq\)</span> negative infinity to &lt; 20 for <em>epi</em> and from <span class="math">\(\geq\)</span> 20 to &lt; positive infinity for <em>hypo</em>.</p>
<p>Or, perhaps you want to define four slices, using the same premise as before, but now dividing the epilimnion into three parts according to latitude. You might write your slice definition as</p>
<pre class="sourceCode r"><code class="sourceCode r">myslice2 &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">epi.south   =</span> <span class="kw">list</span>(<span class="dt">fdp=</span><span class="kw">c</span>(-<span class="ot">Inf</span>,  <span class="dv">20</span>), <span class="dt">lat=</span><span class="kw">c</span>(-<span class="ot">Inf</span>,  <span class="dv">43</span>)),
  <span class="dt">epi.central =</span> <span class="kw">list</span>(<span class="dt">fdp=</span><span class="kw">c</span>(-<span class="ot">Inf</span>,  <span class="dv">20</span>), <span class="dt">lat=</span><span class="kw">c</span>(  <span class="dv">43</span>,  <span class="dv">45</span>)),
  <span class="dt">epi.north   =</span> <span class="kw">list</span>(<span class="dt">fdp=</span><span class="kw">c</span>(-<span class="ot">Inf</span>,  <span class="dv">20</span>), <span class="dt">lat=</span><span class="kw">c</span>(  <span class="dv">45</span>, <span class="ot">Inf</span>)),
  <span class="dt">hypo        =</span> <span class="kw">list</span>(<span class="dt">fdp=</span><span class="kw">c</span>(  <span class="dv">20</span>, <span class="ot">Inf</span>))
  )</code></pre>
<p>Similarly, slices may also be defined by ranges of bottom depths and longitudes. If you wish to define slices by regions that are not simply described by longitudinal or latitudinal breakpoints, for example separating the bays from the main basin, you might write your slice definition as</p>
<pre class="sourceCode r"><code class="sourceCode r">myslice3 &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">epi.bays =</span> <span class="kw">list</span>(<span class="dt">fdp=</span><span class="kw">c</span>(-<span class="ot">Inf</span>,  <span class="dv">20</span>), <span class="dt">reg=</span><span class="kw">c</span>(<span class="st">&quot;Bay A&quot;</span>, <span class="st">&quot;Bay B&quot;</span>)),
  <span class="dt">epi.main =</span> <span class="kw">list</span>(<span class="dt">fdp=</span><span class="kw">c</span>(-<span class="ot">Inf</span>,  <span class="dv">20</span>), <span class="dt">reg=</span><span class="st">&quot;Main&quot;</span>),
  <span class="dt">hypo     =</span> <span class="kw">list</span>(<span class="dt">fdp=</span><span class="kw">c</span>(  <span class="dv">20</span>, <span class="ot">Inf</span>))
  )</code></pre>
<p>I’ll provide some fake data to demonstrate how these slice definitions compare.</p>
<pre class="sourceCode r"><code class="sourceCode r">fishingD &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">13</span>, <span class="dv">10</span>, <span class="dv">17</span>, <span class="dv">15</span>, <span class="dv">18</span>, <span class="dv">22</span>, <span class="dv">21</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">26</span>)
latitude &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">42</span>, <span class="dv">44</span>, <span class="dv">44</span>, <span class="dv">46</span>, <span class="dv">47</span>, <span class="dv">46</span>, <span class="fl">46.1</span>, <span class="dv">66</span>, <span class="fl">43.2</span>, <span class="dv">41</span>)
region &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Bay A&quot;</span>, <span class="st">&quot;Bay B&quot;</span>, <span class="st">&quot;Main&quot;</span>)[<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>)]
s1 &lt;-<span class="st"> </span><span class="kw">sliceCat</span>(myslice1, <span class="dt">fdp=</span>fishingD)
s2 &lt;-<span class="st"> </span><span class="kw">sliceCat</span>(myslice2, <span class="dt">fdp=</span>fishingD, <span class="dt">lat=</span>latitude)
s3 &lt;-<span class="st"> </span><span class="kw">sliceCat</span>(myslice3, <span class="dt">fdp=</span>fishingD, <span class="dt">reg=</span>region)
<span class="kw">data.frame</span>(fishingD, latitude, region, s1, s2, s3)</code></pre>
<pre><code>##    fishingD latitude region   s1          s2       s3
## 1        13     42.0   Main  epi   epi.south epi.main
## 2        10     44.0  Bay A  epi epi.central epi.bays
## 3        17     44.0   Main  epi epi.central epi.main
## 4        15     46.0  Bay B  epi   epi.north epi.bays
## 5        18     47.0   Main  epi   epi.north epi.main
## 6        22     46.0  Bay A hypo        hypo     hypo
## 7        21     46.1  Bay B hypo        hypo     hypo
## 8        25     66.0   Main hypo        hypo     hypo
## 9        24     43.2   Main hypo        hypo     hypo
## 10       26     41.0   Main hypo        hypo     hypo</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># specify reference directory, where Reference.csv file is</span>
<span class="co"># and key values, lake (2=Michigan, 3=Huron) and year of interest</span>
<span class="co"># mydir &lt;- readAll(refdir=&quot;C:/JVA/Consult/Warner/Nearest Trawl&quot;,</span>
<span class="co">#  keyvals=c(2, 2014))</span></code></pre>
<p><a href="http://r-pkgs.had.co.nz/vignettes.html" class="uri">http://r-pkgs.had.co.nz/vignettes.html</a></p>
</div>
</div>
<div id="explore-the-data-1" class="section level2">
<h2>Explore the data</h2>
<p>The <code>exploreACMT</code> function is used to explore the acoustic and midwater trawl data. It requires that an RData file be prepared with all the necessary input data. This can be done with the <code>readAll</code> function. The <code>readAll</code> function requires some data preparation as well, and assumes that your files are organized in a certain way.</p>
</div>
<div id="section" class="section level1">
<h1>*****</h1>
</div>
<div id="this-is-a-work-in-progress" class="section level1">
<h1>This is a work in progress</h1>
</div>
<div id="more-to-come" class="section level1">
<h1>More to come</h1>
</div>
<div id="section-1" class="section level1">
<h1>*****</h1>
<div id="package-development" class="section level2">
<h2>Package development</h2>
<p>To do list:</p>
<ol style="list-style-type: decimal">
<li>update package</li>
<li>remove unneeded columns from files, and test that everything runs okay</li>
</ol>
<p>There are a number of ways that more flexibility could be introduced to the package in its current form. The more flexible the package is, the more useful it will be for general use.</p>
<ol style="list-style-type: decimal">
<li>allow users to organize their file structures differently</li>
<li>allow for more than 2 species with age-length keys</li>
<li>allow user to name the first column of the TS and SV files</li>
<li>allow layers to be defined in different ways (not fixed to 10-m depths)</li>
<li>allow user to specify the names of the date variables</li>
<li>allow user to use different key variables (not stuck with year and lake)</li>
</ol>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Parker-Stetter, S. L., Rudstam, L. G., Sullivan, P. J., and Warner, D. M. 2009. Standard operating procedures for fisheries acoustic surveys in the Great Lakes. Great Lakes Fish. Comm. Spec. Pub. 09-01. <a href="http://www.glfc.org/pubs/SpecialPubs/Sp09_1.pdf">www.glfc.org/pubs/SpecialPubs/Sp09_1.pdf</a>.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
